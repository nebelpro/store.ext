{"version":3,"file":null,"sources":["../src/index.js","../node_modules/store/store.js"],"sourcesContent":["import  __Storage from \"store\";\n\n\n\n/**\n * 将缓存加入标记\n * @param key\n */\nfunction pushCacheQuery(key){\n    let curStore = __Storage.get(\"@@EXPIRE_STORE\") || [];\n    curStore.push(key);\n    __Storage.set('@@EXPIRE_STORE',curStore);\n}\n\n\n/**\n * 清除已过期的缓存\n */\nfunction clearExpireCache(){\n    let curStore = __Storage.get(\"@@EXPIRE_STORE\") || [];\n\n    curStore.forEach(key=>{\n        checkExpireViaTime(key)\n    })\n}\n\n\n\nfunction checkExpireViaTime(key,info){\n    info = info || __Storage.get(key);\n    if (info.exp != -1 && (new Date().getTime() - info.time > info.exp)) {\n        __Storage.remove(key);\n        return false;\n    }else{\n        return true;\n    }\n}\n\nfunction checkExpireViaRead(key,info){\n    info = info || __Storage.get(key);\n\n    if (info && info.read != -1) {\n\n        let readed = (info.readed || 0);\n\n        if(readed>=info.read){\n            __Storage.remove(key);\n            return false;\n        }else{\n            let curReadTime = readed+1;\n            if (curReadTime == info.read) {\n                __Storage.remove(key);\n            }else{\n                info.readed = curReadTime;\n                __Storage.set(key, info);\n            }\n            return true;\n        }\n\n    } else {\n        return true;\n    }\n}\n\n\n\nexport default {\n    clear(){\n        clearExpireCache();\n    },\n    remove: function (key) {\n        __Storage.remove(key);\n    },\n    set: function (key, val, {exp = -1, read = -1}) {\n        let expTime = exp == -1 ? -1 : exp * (60 * 1000);\n        __Storage.set(key, {\n            val: val,\n            exp: expTime,\n            time: new Date().getTime(),\n            read: read\n        })\n\n        // 时间过期，需要放到跟踪队列，读取次数过期不需要，因为读取的时候，读取完，会判断是否还有剩余次数，没有则销毁\n        if(expTime>0){\n            pushCacheQuery(key);\n        }\n    },\n    get: function (key) {\n        var info = __Storage.get(key);\n\n        if (!info) {\n            return null\n        }\n\n        // 时间策略\n        if(!checkExpireViaTime(key,info)){\n            return null;\n        }\n        //读取次数策略\n        if(!checkExpireViaRead(key,info)){\n            return null;\n        }\n\n        return info.val;\n    }\n}\n","\"use strict\"\n// Module export pattern from\n// https://github.com/umdjs/umd/blob/master/returnExports.js\n;(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([], factory);\n    } else if (typeof exports === 'object') {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory();\n    } else {\n        // Browser globals (root is window)\n        root.store = factory();\n  }\n}(this, function () {\n\t\n\t// Store.js\n\tvar store = {},\n\t\twin = (typeof window != 'undefined' ? window : global),\n\t\tdoc = win.document,\n\t\tlocalStorageName = 'localStorage',\n\t\tscriptTag = 'script',\n\t\tstorage\n\n\tstore.disabled = false\n\tstore.version = '1.3.20'\n\tstore.set = function(key, value) {}\n\tstore.get = function(key, defaultVal) {}\n\tstore.has = function(key) { return store.get(key) !== undefined }\n\tstore.remove = function(key) {}\n\tstore.clear = function() {}\n\tstore.transact = function(key, defaultVal, transactionFn) {\n\t\tif (transactionFn == null) {\n\t\t\ttransactionFn = defaultVal\n\t\t\tdefaultVal = null\n\t\t}\n\t\tif (defaultVal == null) {\n\t\t\tdefaultVal = {}\n\t\t}\n\t\tvar val = store.get(key, defaultVal)\n\t\ttransactionFn(val)\n\t\tstore.set(key, val)\n\t}\n\tstore.getAll = function() {}\n\tstore.forEach = function() {}\n\n\tstore.serialize = function(value) {\n\t\treturn JSON.stringify(value)\n\t}\n\tstore.deserialize = function(value) {\n\t\tif (typeof value != 'string') { return undefined }\n\t\ttry { return JSON.parse(value) }\n\t\tcatch(e) { return value || undefined }\n\t}\n\n\t// Functions to encapsulate questionable FireFox 3.6.13 behavior\n\t// when about.config::dom.storage.enabled === false\n\t// See https://github.com/marcuswestin/store.js/issues#issue/13\n\tfunction isLocalStorageNameSupported() {\n\t\ttry { return (localStorageName in win && win[localStorageName]) }\n\t\tcatch(err) { return false }\n\t}\n\n\tif (isLocalStorageNameSupported()) {\n\t\tstorage = win[localStorageName]\n\t\tstore.set = function(key, val) {\n\t\t\tif (val === undefined) { return store.remove(key) }\n\t\t\tstorage.setItem(key, store.serialize(val))\n\t\t\treturn val\n\t\t}\n\t\tstore.get = function(key, defaultVal) {\n\t\t\tvar val = store.deserialize(storage.getItem(key))\n\t\t\treturn (val === undefined ? defaultVal : val)\n\t\t}\n\t\tstore.remove = function(key) { storage.removeItem(key) }\n\t\tstore.clear = function() { storage.clear() }\n\t\tstore.getAll = function() {\n\t\t\tvar ret = {}\n\t\t\tstore.forEach(function(key, val) {\n\t\t\t\tret[key] = val\n\t\t\t})\n\t\t\treturn ret\n\t\t}\n\t\tstore.forEach = function(callback) {\n\t\t\tfor (var i=0; i<storage.length; i++) {\n\t\t\t\tvar key = storage.key(i)\n\t\t\t\tcallback(key, store.get(key))\n\t\t\t}\n\t\t}\n\t} else if (doc && doc.documentElement.addBehavior) {\n\t\tvar storageOwner,\n\t\t\tstorageContainer\n\t\t// Since #userData storage applies only to specific paths, we need to\n\t\t// somehow link our data to a specific path.  We choose /favicon.ico\n\t\t// as a pretty safe option, since all browsers already make a request to\n\t\t// this URL anyway and being a 404 will not hurt us here.  We wrap an\n\t\t// iframe pointing to the favicon in an ActiveXObject(htmlfile) object\n\t\t// (see: http://msdn.microsoft.com/en-us/library/aa752574(v=VS.85).aspx)\n\t\t// since the iframe access rules appear to allow direct access and\n\t\t// manipulation of the document element, even for a 404 page.  This\n\t\t// document can be used instead of the current document (which would\n\t\t// have been limited to the current path) to perform #userData storage.\n\t\ttry {\n\t\t\tstorageContainer = new ActiveXObject('htmlfile')\n\t\t\tstorageContainer.open()\n\t\t\tstorageContainer.write('<'+scriptTag+'>document.w=window</'+scriptTag+'><iframe src=\"/favicon.ico\"></iframe>')\n\t\t\tstorageContainer.close()\n\t\t\tstorageOwner = storageContainer.w.frames[0].document\n\t\t\tstorage = storageOwner.createElement('div')\n\t\t} catch(e) {\n\t\t\t// somehow ActiveXObject instantiation failed (perhaps some special\n\t\t\t// security settings or otherwse), fall back to per-path storage\n\t\t\tstorage = doc.createElement('div')\n\t\t\tstorageOwner = doc.body\n\t\t}\n\t\tvar withIEStorage = function(storeFunction) {\n\t\t\treturn function() {\n\t\t\t\tvar args = Array.prototype.slice.call(arguments, 0)\n\t\t\t\targs.unshift(storage)\n\t\t\t\t// See http://msdn.microsoft.com/en-us/library/ms531081(v=VS.85).aspx\n\t\t\t\t// and http://msdn.microsoft.com/en-us/library/ms531424(v=VS.85).aspx\n\t\t\t\tstorageOwner.appendChild(storage)\n\t\t\t\tstorage.addBehavior('#default#userData')\n\t\t\t\tstorage.load(localStorageName)\n\t\t\t\tvar result = storeFunction.apply(store, args)\n\t\t\t\tstorageOwner.removeChild(storage)\n\t\t\t\treturn result\n\t\t\t}\n\t\t}\n\n\t\t// In IE7, keys cannot start with a digit or contain certain chars.\n\t\t// See https://github.com/marcuswestin/store.js/issues/40\n\t\t// See https://github.com/marcuswestin/store.js/issues/83\n\t\tvar forbiddenCharsRegex = new RegExp(\"[!\\\"#$%&'()*+,/\\\\\\\\:;<=>?@[\\\\]^`{|}~]\", \"g\")\n\t\tvar ieKeyFix = function(key) {\n\t\t\treturn key.replace(/^d/, '___$&').replace(forbiddenCharsRegex, '___')\n\t\t}\n\t\tstore.set = withIEStorage(function(storage, key, val) {\n\t\t\tkey = ieKeyFix(key)\n\t\t\tif (val === undefined) { return store.remove(key) }\n\t\t\tstorage.setAttribute(key, store.serialize(val))\n\t\t\tstorage.save(localStorageName)\n\t\t\treturn val\n\t\t})\n\t\tstore.get = withIEStorage(function(storage, key, defaultVal) {\n\t\t\tkey = ieKeyFix(key)\n\t\t\tvar val = store.deserialize(storage.getAttribute(key))\n\t\t\treturn (val === undefined ? defaultVal : val)\n\t\t})\n\t\tstore.remove = withIEStorage(function(storage, key) {\n\t\t\tkey = ieKeyFix(key)\n\t\t\tstorage.removeAttribute(key)\n\t\t\tstorage.save(localStorageName)\n\t\t})\n\t\tstore.clear = withIEStorage(function(storage) {\n\t\t\tvar attributes = storage.XMLDocument.documentElement.attributes\n\t\t\tstorage.load(localStorageName)\n\t\t\tfor (var i=attributes.length-1; i>=0; i--) {\n\t\t\t\tstorage.removeAttribute(attributes[i].name)\n\t\t\t}\n\t\t\tstorage.save(localStorageName)\n\t\t})\n\t\tstore.getAll = function(storage) {\n\t\t\tvar ret = {}\n\t\t\tstore.forEach(function(key, val) {\n\t\t\t\tret[key] = val\n\t\t\t})\n\t\t\treturn ret\n\t\t}\n\t\tstore.forEach = withIEStorage(function(storage, callback) {\n\t\t\tvar attributes = storage.XMLDocument.documentElement.attributes\n\t\t\tfor (var i=0, attr; attr=attributes[i]; ++i) {\n\t\t\t\tcallback(attr.name, store.deserialize(storage.getAttribute(attr.name)))\n\t\t\t}\n\t\t})\n\t}\n\n\ttry {\n\t\tvar testKey = '__storejs__'\n\t\tstore.set(testKey, testKey)\n\t\tif (store.get(testKey) != testKey) { store.disabled = true }\n\t\tstore.remove(testKey)\n\t} catch(e) {\n\t\tstore.disabled = true\n\t}\n\tstore.enabled = !store.disabled\n\t\n\treturn store\n}));\n"],"names":["pushCacheQuery","key","let","curStore","__Storage","get","push","set","clearExpireCache","forEach","checkExpireViaTime","info","exp","Date","getTime","time","remove","checkExpireViaRead","read","readed","curReadTime","root","factory","define","amd","exports","module","store","this","isLocalStorageNameSupported","localStorageName","win","err","storage","window","global","doc","document","scriptTag","disabled","version","value","defaultVal","has","undefined","clear","transact","transactionFn","val","getAll","serialize","JSON","stringify","deserialize","parse","e","setItem","getItem","removeItem","ret","callback","i","length","documentElement","addBehavior","storageOwner","storageContainer","ActiveXObject","open","write","close","w","frames","createElement","body","withIEStorage","storeFunction","args","Array","prototype","slice","call","arguments","unshift","appendChild","load","result","apply","removeChild","forbiddenCharsRegex","RegExp","ieKeyFix","replace","setAttribute","save","getAttribute","removeAttribute","attributes","XMLDocument","name","attr","testKey","enabled","ref","expTime"],"mappings":"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"}